{"version":3,"sources":["../../src/controllers/user.js"],"names":["config","db","api","get","req","res","find","email","params","altemail","err","altid","status","send","length","header","findById","user","realid","id","realemail","json","post","newUser","body","save","message","newAltID","altids","push"],"mappings":"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","file":"user.js","sourcesContent":["////////////////////////////////////////\n// ADFSUserMappingAPI\n//\n// Copyright (c) 2017 Jonathan Hardison\n// /controllers/user.js\n///////////////////////////////////////\n\nimport mongoose from 'mongoose';\nimport express from 'express';\nimport {Router} from 'express';\nimport User from '../models/user';\nimport Altid from '../models/altid';\n\n\nexport default({ config, db}) => {\n    let api = Router();\n    \n    // general get from alternate email address input  \n    api.get('/altid/email/:altemail', (req, res) => {\n        Altid.find({email: req.params.altemail}, (err, altid) =>{\n            if(err){\n                res.status(500).send(err);\n            }\n\n            if((typeof altid !== \"undefined\") && (altid.length > 0)){\n                //adding CORS here, but need to refactor the middleware to support it with Next()\n                res.header(\"Access-Control-Allow-Origin\", \"*\");\n                res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept\");\n                \n                User.findById(altid[0].user, (err, user) =>{\n                    if(err){\n                        res.status(500).send(err);\n                    }\n                    \n                    res.status(200).send(user.realid);\n                });\n            }\n            else{\n                res.status(200).send(req.params.altemail);\n            }\n            \n        }) \n    });\n\n    // general get from alternate email by id\n    api.get('/altid/:id', (req, res) => {\n        Altid.findById(req.params.id, (err, altid) =>{\n            if(err){\n                res.status(500).send(err);\n            }\n            res.status(200).send(altid.realid);\n        }) \n    });\n    \n    // general get from real email address input\n    api.get('/email/:realemail', (req, res) => {\n        User.find({realid: req.params.realemail}, (err, user) =>{\n            if(err){\n                res.status(500).send(err);\n            }\n            res.status(200).json(user);\n        }) \n    });\n\n    // general get from real email address input with ID\n    api.get('/:id', (req, res) => {\n        User.findById(req.params.realemail, (err, user) =>{\n            if(err){\n                res.status(500).send(err);\n            }\n            res.status(200).json(user);\n        }) \n    });\n\n    // general post to stage some users\n    api.post('/', (req, res) => {\n        let newUser = new User();\n        newUser.realid = req.body.realid;\n\n        newUser.save(err => {\n            if(err){\n                res.status(500).send(err);\n            }\n            res.status(200).json({message: \"Real user created successfully\"});\n        });\n    });\n\n    // general post to stage some alt id's\n    api.post('/altid/:realid', (req, res) => {\n        User.findById(req.params.realid, (err, user) => {\n            if(err){\n                res.status(500).send(err);\n            }\n            let newAltID = new Altid();\n            newAltID.email = req.body.email;\n            newAltID.user = user.id;\n\n            newAltID.save((err, altid) => {\n            if(err){\n                res.status(500).send(err);\n            }\n            user.altids.push(newAltID);\n            user.save(err => {\n                if(err){\n                    res.status(500).send(err);\n                }\n                res.status(200).json({message: \"Alt ID created successfully\"});\n                }); \n            });\n        });\n    });\n\n\n\n    return api;\n}"]}